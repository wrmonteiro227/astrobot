// Localize a funÃ§Ã£o enviarMensagem() e substitua o bloco 'consulta' por este:

} else if (analise.categoria === 'consulta') {
    const tabela = (analise.tipo === 'tarefas') ? 'tarefas' : 'financas';
    
    // Busca TODOS os dados do usuÃ¡rio para filtrar no Front-end (mais preciso com Timezone)
    const { data, error } = await meuSupabase.from(tabela).select('*').eq('cliente_id', idUsuario);
    
    if (error) { console.error(error); return; }

    const f = obterFiltrosTemporais(analise.periodo);
    
    let filtrados = data ? data.filter(item => {
        // Valida se o tipo (entrada/saida) bate com a consulta
        if (tabela === 'financas' && item.tipo !== analise.tipo) return false;
        
        // Valida o tempo (converte created_at para o dia local do Tony)
        const dataItem = new Date(item.created_at).getTime();
        if (analise.periodo === 'tudo') return true;
        return dataItem >= f.inicio && dataItem <= f.fim;
    }) : [];

    if (filtrados.length > 0) {
        let r = `Aqui estÃ¡ o que encontrei para ${analise.periodo}:\n\n`;
        let total = 0;
        filtrados.forEach(i => {
            const dataObjeto = new Date(i.created_at);
            const dF = dataObjeto.toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit'});
            if (tabela === 'financas') {
                total += i.valor;
                r += `ðŸ“… ${dF} - R$ ${i.valor.toFixed(2)} (${i.descricao})\n`;
            } else {
                r += `â€¢ ${i.descricao}\n`;
            }
        });
        if (tabela === 'financas') r += `\nðŸ’° TOTAL: R$ ${total.toFixed(2)}`;
        adicionarMensagem(r, 'bot');
    } else {
        adicionarMensagem(`Nada encontrado para "${analise.periodo}". ðŸ˜Ž`, 'bot');
    }
}
