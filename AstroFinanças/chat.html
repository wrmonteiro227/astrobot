<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astro Finanças - Chat</title>
    <style>
        :root { --primary: #00ff88; --bg: #0a0a0a; --card: #161616; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; h-100vh; }
        #chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { max-width: 80%; padding: 12px 18px; border-radius: 15px; font-size: 14px; line-height: 1.4; }
        .user { align-self: flex-end; background: var(--primary); color: black; font-weight: 500; }
        .astro { align-self: flex-start; background: var(--card); border: 1px solid #333; }
        #input-area { padding: 20px; background: #111; display: flex; gap: 10px; border-top: 1px solid #222; }
        input { flex: 1; background: #222; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px; outline: none; }
        button { background: var(--primary); border: none; padding: 0 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div id="chat-container">
        <div class="msg astro">Olá, Tony Stark. Como posso ajudar com suas finanças ou tarefas hoje?</div>
    </div>

    <div id="input-area">
        <input type="text" id="userInput" placeholder="Ex: Gastei 50,00 com VT Lixeiro...">
        <button onclick="sendMessage()">Enviar</button>
    </div>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('userInput');

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            // Adiciona balão do usuário
            appendMessage(text, 'user');
            userInput.value = '';

            try {
                // Chamada para a Serverless Function no Vercel
                const response = await fetch('/api/cerebro', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text, userId: 'stark_01' })
                });

                const data = await response.json();
                
                // Lógica de Resposta do Astro
                appendMessage(data.mensagem, 'astro');

                // Se houver payload de consulta, aqui você chamaria a renderização de tabelas
                if(data.tipo === 'consulta') {
                    console.log("Iniciando busca no banco para:", data.filtro);
                }

            } catch (err) {
                appendMessage("Erro na conexão com o Cérebro. Verifique os logs.", "astro");
                console.error(err);
            }
        }

        function appendMessage(text, side) {
            const div = document.createElement('div');
            div.className = `msg ${side}`;
            div.innerText = text;
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>
</html>
